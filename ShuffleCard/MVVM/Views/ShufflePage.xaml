<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ShuffleCard.MVVM.Views.ShufflePage"
             xmlns:viewmodels="clr-namespace:ShuffleCard.MVVM.ViewModels"
             Shell.NavBarIsVisible="False"
             BackgroundColor="#000044">

    <ContentPage.BindingContext>
        <viewmodels:FlashcardViewModel />
    </ContentPage.BindingContext>

    <Grid>
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="25" VerticalOptions="Center">

                <!-- Header Section -->
                <VerticalStackLayout Spacing="15">
                    <Label Text="Flashcards"
                           FontSize="32"
                           FontAttributes="Bold"
                           TextColor="#f3f3f3"
                           HorizontalTextAlignment="Center" />

                    <Label Text="Test your knowledge"
                           FontSize="16"
                           TextColor="#3ffffD"
                           HorizontalTextAlignment="Center"
                           Margin="0,0,0,10" />
                </VerticalStackLayout>

                <!-- Feedback Banner -->
                <Border IsVisible="{Binding IsFeedbackVisible}"
                        BackgroundColor="#4CAF50"
                        Padding="15"
                        StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="Black"
                                Offset="0,3"
                                Radius="8"
                                Opacity="0.2" />
                    </Border.Shadow>

                    <Label Text="{Binding FeedbackMessage}"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalTextAlignment="Center" />
                </Border>

                <!-- Flashcard Container -->
                <Border x:Name="CardContainer"
                        BackgroundColor="White"
                        Padding="30"
                        StrokeThickness="0"
                        HeightRequest="400">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="20" />
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="Black"
                                Offset="0,4"
                                Radius="15"
                                Opacity="0.15" />
                    </Border.Shadow>

                    <VerticalStackLayout Spacing="30" VerticalOptions="Center">
                        <!-- Question Section -->
                        <VerticalStackLayout Spacing="15">
                            <Label Text="Question"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#6C63FF"
                                   HorizontalTextAlignment="Center" />

                            <Label Text="{Binding CurrentFlashcard.Question}"
                                   FontSize="22"
                                   FontAttributes="Bold"
                                   TextColor="#2C3E50"
                                   HorizontalTextAlignment="Center"
                                   LineBreakMode="WordWrap"
                                   MaxLines="4" />
                        </VerticalStackLayout>

                        <!-- Divider -->
                        <BoxView HeightRequest="2"
                                 BackgroundColor="#E8E8E8"
                                 HorizontalOptions="Fill"
                                 Margin="20,0" />

                        <!-- Answer Section -->
                        <VerticalStackLayout Spacing="15">
                            <Label Text="Answer"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#6C63FF"
                                   HorizontalTextAlignment="Center" />

                            <!-- Correct Answer (Shown when revealed) -->
                            <Border x:Name="AnswerFrame"
                                    BackgroundColor="{Binding CurrentFlashcard.IsCorrect, 
                                        Converter={StaticResource AnswerBackgroundConverter}}"
                                    Padding="20"
                                    StrokeThickness="0"
                                    MinimumHeightRequest="80"
                                    IsVisible="{Binding IsAnswerRevealed}">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12" />
                                </Border.StrokeShape>

                                <Label Text="{Binding CurrentFlashcard.Answer}"
                                       FontSize="16"
                                       TextColor="{Binding CurrentFlashcard.IsCorrect, 
                                           Converter={StaticResource AnswerTextColorConverter}}"
                                       FontAttributes="Bold"
                                       HorizontalTextAlignment="Center"
                                       VerticalTextAlignment="Center"
                                       LineBreakMode="WordWrap" />
                            </Border>

                            <!-- Placeholder (Shown when answer not revealed) -->
                            <Label Text="Type your answer below and press Enter"
                                   FontSize="16"
                                   TextColor="#999999"
                                   FontAttributes="Italic"
                                   HorizontalTextAlignment="Center"
                                   IsVisible="{Binding IsAnswerRevealed, Converter={StaticResource InverseBoolConverter}}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- Answer Entry Field -->
                <Border BackgroundColor="White"
                        StrokeThickness="1"
                        Stroke="#E0E0E0"
                        StrokeShape="RoundRectangle 15"
                        HeightRequest="55">
                    <Border.Shadow>
                        <Shadow Brush="Black"
                                Offset="0,3"
                                Radius="8"
                                Opacity="0.2" />
                    </Border.Shadow>

                    <Entry Text="{Binding UserAnswer}"
                           Placeholder="Type your answer here..."
                           TextColor="#2C3E50"
                           FontSize="16"
                           BackgroundColor="Transparent"
                           HorizontalTextAlignment="Center"
                           VerticalOptions="Center"
                           ReturnCommand="{Binding SubmitAnswerCommand}"
                           Margin="15,0"/>
                </Border>

                <!-- Navigation Buttons -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                    <Button Grid.Column="0"
                            Text="Previous"
                            BackgroundColor="#3498DB"
                            TextColor="White"
                            FontSize="16"
                            FontAttributes="Bold"
                            CornerRadius="12"
                            HeightRequest="50"
                            Command="{Binding PreviousCommand}">
                        <Button.Shadow>
                            <Shadow Brush="Black"
                                    Offset="0,2"
                                    Radius="6"
                                    Opacity="0.15" />
                        </Button.Shadow>
                    </Button>

                    <Button Grid.Column="1"
                            Text="Next"
                            BackgroundColor="#2ECC71"
                            TextColor="White"
                            FontSize="16"
                            FontAttributes="Bold"
                            CornerRadius="12"
                            HeightRequest="50"
                            Command="{Binding NextCommand}">
                        <Button.Shadow>
                            <Shadow Brush="Black"
                                    Offset="0,2"
                                    Radius="6"
                                    Opacity="0.15" />
                        </Button.Shadow>
                    </Button>
                </Grid>

                <!-- Action Button -->
                <VerticalStackLayout Margin="0,10,0,0">
                    <Button Text="Shuffle"
                            BackgroundColor="#F39C12"
                            TextColor="White"
                            FontSize="16"
                            FontAttributes="Bold"
                            CornerRadius="12"
                            HeightRequest="50"
                            Command="{Binding ShuffleCommand}">
                        <Button.Shadow>
                            <Shadow Brush="Black"
                                    Offset="0,2"
                                    Radius="6"
                                    Opacity="0.15" />
                        </Button.Shadow>
                    </Button>
                </VerticalStackLayout>

                <!-- Progress Indicator -->
                <Label Text="{Binding ProgressText}"
                       FontSize="14"
                       TextColor="#FFFFFF"
                       HorizontalTextAlignment="Center" />

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>